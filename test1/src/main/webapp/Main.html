<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>뮤지컬 메인 페이지</title>
    <link rel="stylesheet" href="./css/메인.css">
</head>
<body>
    <!-- 헤더 영역 -->
    <header class="header">
        <div class="Frame1">
            <div class="categories">
                <div class="category">국내창작</div>
                <div class="category">라이센스</div>
                <div class="category">게시판</div>
            </div>
            <div class="BtnSignUp">회원가입</div>
            <div class="BtnLogin">로그인</div>
            <img src="./img/icon_my.png" class="icon_my" alt="My Icon">
        </div>
    </header>

    <!-- 슬라이드 영역 -->
    <section class="slide-list">
        <div class="slide">
            <div class="slide-track">
                <img src="./img/물랑루즈.JPG" alt="물랑루즈 포스터">
                <img src="./img/tcktck 2.png" alt="다른 포스터">
                <img src="./img/물랑루즈.JPG" alt="물랑루즈 포스터">
            </div>
        </div>
    </section>

    <!-- 콘텐츠 리스트 섹션 -->
    <main>
        <section class="content-list">
            <div class="search_frame">
                <div class="whole_list">전체목록</div>
                <input type="text" placeholder="작품명을 입력하세요" class="search">
            </div>

            <div class="content-list__items" id="content-list">
                <!-- 동적으로 데이터가 삽입될 영역 -->
            </div>
            <button id="load-more" style="display: block; margin: 20px auto;">더 보기</button>
        </section>
    </main>

    <script>
        let currentPage = 1;
        const itemsPerPage = 25;

        // 콘텐츠 로드 함수
        async function loadContent(page) {
            try {
                // 서버에서 뮤지컬 데이터 가져오기
                const response = await fetch('http://localhost:8082/test1/MainCon');
                if (!response.ok) {
                    throw new Error(`HTTP 오류! 상태 코드: ${response.status}`);
                }
                const data = await response.json();

                // 현재 페이지의 항목 계산
                const startIndex = (page - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const currentItems = data.slice(startIndex, endIndex);

                // 콘텐츠 리스트에 추가
                const contentList = document.getElementById('content-list');
                currentItems.forEach(musical => {
                    const item = document.createElement('div');
                    item.className = 'content-item';
                    item.style.textAlign = 'center';

                    // 동적으로 항목 생성
                    item.innerHTML = `
                        <a href="detail.html?musicalIdx=${musical.musicalIdx}">
                            <img src="${musical.musicalPoster}" alt="${musical.musicalTitle}" class="musical-poster" style="width: 250px; height: 250px;">
                            <div>${musical.musicalTitle}</div>
                        </a>
                    `;
                    contentList.appendChild(item);
                });

                // 데이터가 더 이상 없으면 "더 보기" 버튼 숨기기
                if (endIndex >= data.length) {
                    document.getElementById('load-more').style.display = 'none';
                }
            } catch (error) {
                console.error('콘텐츠 로드 중 오류 발생:', error);
            }
        }

        // 페이지 로드 시 데이터 가져오기
        loadContent(currentPage);

        // "더 보기" 버튼 클릭 이벤트
        document.getElementById('load-more').addEventListener('click', () => {
            currentPage++;
            loadContent(currentPage);
        });

        // 버튼 이벤트: 로그인 페이지로 이동
        document.querySelector('.BtnLogin').addEventListener('click', () => {
            window.location.href = 'login.html';
        });

        // 버튼 이벤트: 회원가입 페이지로 이동
        document.querySelector('.BtnSignUp').addEventListener('click', () => {
            window.location.href = 'signUp.html';
        });

        // 게시판 버튼 이벤트
        document.querySelector('.categories .category:nth-child(3)').addEventListener('click', () => {
            window.location.href = 'Board.jsp';
        });

        // 슬라이드 동작
        const slideTrack = document.querySelector('.slide-track');
        const slides = slideTrack.children;
        let currentIndex = 0;

        function updateSlidePosition() {
            slideTrack.style.transform = `translateX(-${currentIndex * 240}px)`;
        }

        function nextSlide() {
            currentIndex = (currentIndex + 1) % slides.length;
            updateSlidePosition();
        }

        setInterval(nextSlide, 3000);
    </script>
</body>
</html>
